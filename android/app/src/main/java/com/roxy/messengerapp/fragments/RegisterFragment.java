package com.roxy.messengerapp.fragments;import android.content.Intent;import android.os.Bundle;import android.text.TextUtils;import android.view.LayoutInflater;import android.view.View;import android.view.ViewGroup;import android.widget.Button;import android.widget.EditText;import android.widget.TextView;import android.widget.Toast;import androidx.annotation.NonNull;import androidx.annotation.Nullable;import androidx.fragment.app.Fragment;import androidx.navigation.Navigation;import com.roxy.messengerapp.R;import com.roxy.messengerapp.activities.MainActivity;import com.roxy.messengerapp.network.ApiClient;import com.roxy.messengerapp.network.ApiService;import com.roxy.messengerapp.network.SocketManager;import retrofit2.Call;import retrofit2.Callback;import retrofit2.Response;public class RegisterFragment extends Fragment {    EditText username, email, password;    Button btn_register;    TextView tv_login;    @Override    public View onCreateView(LayoutInflater inflater, ViewGroup container,                             Bundle savedInstanceState) {        return inflater.inflate(R.layout.fragment_register, container, false);    }    @Override    public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {        super.onViewCreated(view, savedInstanceState);        username = view.findViewById(R.id.username);        email = view.findViewById(R.id.email);        password = view.findViewById(R.id.password);        btn_register = view.findViewById(R.id.btn_register);        tv_login = view.findViewById(R.id.tv_login);        tv_login.setOnClickListener(v -> {            Navigation.findNavController(v).navigate(R.id.action_register_to_login);        });        btn_register.setOnClickListener(v -> {            String txt_username = username.getText().toString().trim();            String txt_email = email.getText().toString().trim();            String txt_password = password.getText().toString().trim();            if (TextUtils.isEmpty(txt_username) || TextUtils.isEmpty(txt_email) || TextUtils.isEmpty(txt_password)) {                Toast.makeText(getContext(), "Заполните все поля", Toast.LENGTH_SHORT).show();                return;            }            if (txt_password.length() < 6) {                Toast.makeText(getContext(), "Пароль минимум 6 символов", Toast.LENGTH_SHORT).show();                return;            }            register(txt_username, txt_email, txt_password);        });    }    private void register(String username, String email, String password) {        btn_register.setEnabled(false);        btn_register.setText("Регистрация...");        ApiService.RegisterRequest request = new ApiService.RegisterRequest(username, email, password);        ApiClient.getApi().register(request).enqueue(new Callback<ApiService.AuthResponse>() {            @Override            public void onResponse(Call<ApiService.AuthResponse> call, Response<ApiService.AuthResponse> response) {                btn_register.setEnabled(true);                btn_register.setText("Зарегистрироваться");                if (response.isSuccessful() && response.body() != null) {                    ApiService.AuthResponse authResponse = response.body();                    // Сохраняем токен                    ApiClient.setToken(requireContext(), authResponse.token);                    // Подключаем сокет                    SocketManager.getInstance().connect(authResponse.token);                    Toast.makeText(getContext(), "Добро пожаловать, " + authResponse.user.getUsername(), Toast.LENGTH_SHORT).show();                    // Переход в MainActivity                    Intent intent = new Intent(requireActivity(), MainActivity.class);                    intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);                    startActivity(intent);                    requireActivity().finish();                } else {                    String errorMsg = "Ошибка регистрации";                    try {                        if (response.errorBody() != null) {                            errorMsg = response.errorBody().string();                        }                    } catch (Exception e) {                        e.printStackTrace();                    }                    Toast.makeText(getContext(), errorMsg, Toast.LENGTH_SHORT).show();                }            }            @Override            public void onFailure(Call<ApiService.AuthResponse> call, Throwable t) {                btn_register.setEnabled(true);                btn_register.setText("Зарегистрироваться");                Toast.makeText(getContext(), "Ошибка сети: " + t.getMessage(), Toast.LENGTH_SHORT).show();            }        });    }}